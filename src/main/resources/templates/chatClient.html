<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
</head>
<body>
	<div id="app">
		<form>
			<!-- 메세지 표시영역 -->
			<textarea id="messageBox" readonly="readonly" rows="10" cols="45"></textarea><br>
			<!-- 텍스트입력창 -->
			<input type="text" id="messageInput" size="50" />
			<!-- 송신버튼 -->
			<input type="button" value="전송" onclick="sendMessage()" />
		</form>
		
		<!--
		<form>
			<textarea id="messageBox" readonly="readonly" rows="10" cols="45"></textarea><br>
			<input v-model="message" v-on:keyup.enter="sendMessage()"/>
			<button v-on:click="sendMessage()">전송</button>
		</form>	
		-->	 
	</div>
</body>




<script type="text/javascript">
	
	//테스트용 임시 유저정보
	var userInformation = {
	        name: 'Sam',
	        signData: 'yyyy-MM-dd HH:mm:ss'
	    };
	
	//웹소켓 초기화
	var webSocket = new WebSocket("ws://localhost:8080/communications/websocket");
	var messageBox = document.getElementById("messageBox");
	
	//서버 연결시 유저정보 전송
	webSocket.onopen = function sendUserInformation(e) {
		$.ajax({
            type: 'POST',
            url: "ws://localhost:8080/communications/websocket",
            dataType: 'json',
            data: JSON.stringify(userInformation)
        }).done(function() {
            alert('채팅서버에 연결되었습니다.');
            
        }).fail(function (error) {
            alert("채팅서버에 연결할 수 없습니다."");
        });
	}
	
	//메시지가 오면 출력
	webSocket.onmessage = function updateMessage(message) {
		//JSON 언박싱
		var jsonData = JSON.parse(message.data);
		if(jsonData.message != null) {
			messageBox.value += jsonData.username + ":" + jsonData.message + "\n"
		};
	}
	
	//서버로 메시지 보내기
	function sendMessage() {
		var messageInput = document.getElementById("messageInput");
		webSocket.send(messageInput.value);
		messageInput.value = "";
	}

</script>


<!--
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.10/vue.min.js"></script>
<script language="javascript" type="text/javascript">

	const app = new Vue({
		el: '#messageBox',
		data: {
			message: ""
		},
		methods: {
			sendMessage() {
				var messageInput = this.message;
				webSocket.send(messageInput.value);
				messageInput.value = "";
			}
		}
	})

</script>
-->


</html>